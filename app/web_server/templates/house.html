{% extends "base.html" %}

{% block style %}
{% endblock %}

{% block body %}
<div class="container">
    {% include "header.html" %}

    <div style="margin: 0 auto; width: 800px;">
        <canvas id="renderingZone" width="800px" height="600px">
            WebGL 2 canvas
        </canvas>

        <div style="padding: 10px 0;">
            <select id="houseViewType" class="form-control">
                 <option value="Default" selected="selected">Default view</option>
                 <option value="Temperature">Temperature View</option>
                 <option value="Humidity">Humidity View</option>
            </select>
        </div>
    </div>
</div>



{% endblock body %}

{% block javascript %}

<script type="text/javascript" src="static/webgl/utils.js"></script>
<script type="text/javascript" src="static/webgl/console.js"></script>
<script type="text/javascript" src="static/webgl/camera.js"></script>
<script type="text/javascript" src="static/webgl/house_view.js"></script>

<script type="text/javascript">

    function main()
    {
        var output = new EngineConsole();

        var house = new House();


        // house.addRoom(-2.5, -2.5, 5, 5);
        house.addRoom(+2.5, -2.5, 5, 4);
        // house.addDevice("id", 2.5, 2.5, 3, {});
        // house.addDevice("id", -2.5, -2.5, 3, {});

        var house_view = new HouseView(output, "renderingZone", house);
        house_view.camera.from = [-2.0, -5.0, 5.0];
        house_view.update();

        apiCall('/room', 'GET', {}, function(data) {
            $.each(data.result, function(i, room) {
                house.addRoom(room.x, room.y, room.width, room.height);
            });
            house_view.update_model();
        });

        apiCall('/sensor', 'GET', {}, function(data) {
            $.each(data.result, function(i, sensor) {
                if (sensor.ignored)
                {
                    return;
                }

                var values = {};

                if (sensor.type == 'Thermometer')
                {
                    values['Temperature'] = Math.random() * 30.0 + 5.0;
                    values['Humidity'] = Math.random() * 100.0;
                }

                house.addDevice(sensor.device_id, sensor.x, sensor.y, 4, values);
            });
            house_view.update_model();
        });

        document.getElementById("houseViewType").onchange = function()
        {
            e = document.getElementById("houseViewType");

            house_view.set_view_mode(e.value);
        }
    }

    document.body.onload = function()
    {
        main();
    }

</script>

{% endblock %}
